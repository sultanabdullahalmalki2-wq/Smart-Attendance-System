<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#1a237e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">    
    
<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Tajawal',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;overflow-x:hidden}
.container{max-width:1200px;margin:0 auto;padding:20px}

/* =================== Navigation =================== */
.nav{background:white;border-radius:15px;padding:15px;margin-bottom:20px;display:flex;justify-content:space-around;box-shadow:0 5px 20px rgba(0,0,0,0.1);position:sticky;top:20px;z-index:100}
.nav-item{flex:1;text-align:center;padding:12px;border-radius:10px;cursor:pointer;transition:all 0.3s;color:#666;font-weight:500}
.nav-item:hover{background:#f5f5f5;transform:translateY(-2px)}
.nav-item.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;box-shadow:0 4px 15px rgba(102,126,234,0.4)}
.nav-item i{display:block;font-size:24px;margin-bottom:5px}

/* =================== Page Styles =================== */
.page{display:none;animation:fadeIn 0.5s ease-in-out}
.page.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* =================== Cards =================== */
.card{background:white;border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 5px 20px rgba(0,0,0,0.1);animation:slideUp 0.5s ease-out}
@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}
.card-title{font-size:1.5rem;font-weight:700;color:#1a237e;display:flex;align-items:center;gap:10px}
.card-title i{font-size:1.8rem;color:#667eea}

/* =================== Buttons =================== */
.btn{padding:12px 24px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s;font-family:'Tajawal',sans-serif;display:inline-flex;align-items:center;gap:8px;justify-content:center}
.btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;box-shadow:0 4px 15px rgba(102,126,234,0.4)}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,0.6)}
.btn-primary:active{transform:translateY(0)}

.btn-success{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:white;box-shadow:0 4px 15px rgba(17,153,142,0.4)}
.btn-danger{background:linear-gradient(135deg,#eb3349 0%,#f45c43 100%);color:white;box-shadow:0 4px 15px rgba(235,51,73,0.4)}
.btn-warning{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;box-shadow:0 4px 15px rgba(240,147,251,0.4)}
.btn-secondary{background:#f5f5f5;color:#666;border:2px solid #e0e0e0}

/* =================== Forms =================== */
.form-group{margin-bottom:20px}
.form-label{display:block;margin-bottom:8px;font-weight:600;color:#333;font-size:15px}
.form-input,.form-select{width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:10px;font-size:15px;font-family:'Tajawal',sans-serif;transition:all 0.3s}
.form-input:focus,.form-select:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1)}

/* =================== Student List =================== */
.student-list{display:grid;gap:15px}
.student-item{background:#f8f9fa;padding:15px;border-radius:12px;display:flex;justify-content:space-between;align-items:center;transition:all 0.3s;border-right:4px solid transparent}
.student-item:hover{background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.08);transform:translateX(-5px);border-right-color:#667eea}

.student-info{flex:1}
.student-name{font-size:1.1rem;font-weight:700;color:#1a237e;margin-bottom:5px}
.student-details{display:flex;gap:15px;flex-wrap:wrap;font-size:14px;color:#666}
.student-detail{display:flex;align-items:center;gap:5px}
.student-detail i{color:#667eea}

.student-actions{display:flex;gap:10px}
.btn-icon{width:40px;height:40px;border-radius:10px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;font-size:16px}
.btn-icon.present{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:white}
.btn-icon.absent{background:linear-gradient(135deg,#eb3349 0%,#f45c43 100%);color:white}
.btn-icon.edit{background:#667eea;color:white}
.btn-icon.delete{background:#f45c43;color:white}
.btn-icon:hover{transform:scale(1.1)}

/* =================== Stats Cards =================== */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
.stat-card{background:white;padding:20px;border-radius:12px;text-align:center;box-shadow:0 3px 10px rgba(0,0,0,0.1);transition:all 0.3s}
.stat-card:hover{transform:translateY(-5px);box-shadow:0 5px 20px rgba(0,0,0,0.15)}
.stat-icon{font-size:2.5rem;margin-bottom:10px}
.stat-value{font-size:2rem;font-weight:900;margin-bottom:5px}
.stat-label{color:#666;font-size:14px;font-weight:500}

/* =================== Search Box =================== */
.search-box{position:relative;margin-bottom:20px}
.search-input{width:100%;padding:15px 50px 15px 20px;border:2px solid #e0e0e0;border-radius:12px;font-size:16px;transition:all 0.3s}
.search-input:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1)}
.search-icon{position:absolute;left:20px;top:50%;transform:translateY(-50%);color:#667eea;font-size:20px}

/* =================== Attendance Table =================== */
.attendance-table{width:100%;border-collapse:separate;border-spacing:0 10px}
.attendance-table th{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:15px;text-align:right;font-weight:600;position:sticky;top:0;z-index:10}
.attendance-table th:first-child{border-radius:12px 0 0 12px}
.attendance-table th:last-child{border-radius:0 12px 12px 0}
.attendance-table td{background:#f8f9fa;padding:15px;border:none}
.attendance-table tr:hover td{background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
.attendance-table tbody tr td:first-child{border-radius:12px 0 0 12px}
.attendance-table tbody tr td:last-child{border-radius:0 12px 12px 0}

/* =================== Status Badges =================== */
.status-badge{padding:6px 12px;border-radius:20px;font-size:13px;font-weight:600;display:inline-block}
.status-present{background:#d4edda;color:#155724}
.status-absent{background:#f8d7da;color:#721c24}
.status-late{background:#fff3cd;color:#856404}

/* =================== Modal =================== */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center}
.modal.active{display:flex}
.modal-content{background:white;border-radius:20px;padding:30px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto;animation:modalSlideIn 0.3s ease-out}
@keyframes modalSlideIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}
.modal-title{font-size:1.5rem;font-weight:700;color:#1a237e}
.modal-close{background:none;border:none;font-size:24px;cursor:pointer;color:#666;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all 0.3s}
.modal-close:hover{background:#f0f0f0;color:#1a237e}

/* =================== Empty State =================== */
.empty-state{text-align:center;padding:60px 20px;color:#666}
.empty-icon{font-size:4rem;margin-bottom:20px;opacity:0.5}
.empty-text{font-size:1.2rem;margin-bottom:10px}
.empty-subtext{font-size:14px;color:#999}

/* =================== Loading Spinner =================== */
.spinner{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:40px auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* =================== Toast Notification =================== */
.toast{position:fixed;bottom:30px;right:30px;background:white;padding:15px 20px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.2);z-index:10000;display:flex;align-items:center;gap:12px;min-width:300px;transform:translateX(400px);transition:transform 0.3s ease-out}
.toast.show{transform:translateX(0)}
.toast-icon{font-size:24px}
.toast.success{border-right:4px solid #38ef7d}
.toast.success .toast-icon{color:#38ef7d}
.toast.error{border-right:4px solid #f45c43}
.toast.error .toast-icon{color:#f45c43}
.toast.info{border-right:4px solid #667eea}
.toast.info .toast-icon{color:#667eea}

/* =================== File Upload =================== */
.file-upload{border:3px dashed #e0e0e0;border-radius:15px;padding:40px;text-align:center;cursor:pointer;transition:all 0.3s;background:#f8f9fa}
.file-upload:hover{border-color:#667eea;background:#fff}
.file-upload.dragover{border-color:#667eea;background:#e8eaf6;transform:scale(1.02)}
.file-icon{font-size:3rem;color:#667eea;margin-bottom:15px}
.file-text{font-size:16px;color:#666;margin-bottom:10px}
.file-subtext{font-size:13px;color:#999}

/* =================== Export Buttons =================== */
.export-buttons{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}

/* =================== Subscription Badge =================== */
.subscription-badge{background:white;padding:15px 20px;border-radius:12px;display:flex;align-items:center;gap:15px;margin-bottom:20px;box-shadow:0 3px 10px rgba(0,0,0,0.1)}
.subscription-icon{font-size:2rem}
.subscription-info{flex:1}
.subscription-status{font-weight:700;font-size:16px;margin-bottom:5px}
.subscription-expiry{font-size:13px;color:#666}
.subscription-badge.trial{border-right:4px solid #ff9800}
.subscription-badge.active{border-right:4px solid #4caf50}
.subscription-badge.warning{border-right:4px solid #f44336;animation:pulse 2s infinite}

/* =================== Lock Screen & Payment Page =================== */
#lockScreen, #paymentPage{position:fixed;top:0;left:0;width:100vw;min-height:100vh;height:auto;z-index:99999;overflow-y:auto;-webkit-overflow-scrolling:touch}
.lock-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg, rgba(26,35,126,0.95) 0%, rgba(13,71,161,0.95) 100%);backdrop-filter:blur(10px)}
.lock-container, .payment-container{position:relative;z-index:1;max-width:500px;margin:0 auto;padding:20px;min-height:100vh;display:flex;flex-direction:column;justify-content:center}
.lock-header{text-align:center;margin-bottom:30px;animation:fadeInDown 0.6s ease-out}
.lock-icon-main{font-size:70px;margin-bottom:15px;animation:bounce 2s infinite}
.lock-main-title{color:white;font-size:2rem;margin-bottom:10px;font-weight:900}
.lock-subtitle{color:rgba(255,255,255,0.9);font-size:1.1rem}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes fadeInDown{from{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}

.features-grid{display:grid;gap:15px;margin-bottom:30px}
.feature-item{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);padding:20px;border-radius:15px;border:2px solid rgba(255,255,255,0.2);display:flex;align-items:start;gap:15px;transition:all 0.3s}
.feature-item:hover{background:rgba(255,255,255,0.15);transform:translateX(-5px)}
.feature-icon{font-size:2rem;min-width:50px;height:50px;background:rgba(255,255,255,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center}
.feature-content{flex:1}
.feature-title{color:white;font-size:1.1rem;font-weight:700;margin-bottom:5px}
.feature-text{color:rgba(255,255,255,0.8);font-size:14px;line-height:1.6}

.btn-subscribe-main{width:100%;padding:18px;background:linear-gradient(135deg,#ffd89b 0%,#19547b 100%);color:white;border:none;border-radius:15px;font-size:1.2rem;font-weight:900;cursor:pointer;transition:all 0.3s;box-shadow:0 8px 25px rgba(255,216,155,0.4);margin-bottom:15px;display:flex;align-items:center;justify-content:center;gap:10px}
.btn-subscribe-main:hover{transform:translateY(-3px);box-shadow:0 12px 35px rgba(255,216,155,0.6)}
.btn-subscribe-main:active{transform:translateY(0)}

.guarantee{text-align:center;color:rgba(255,255,255,0.9);font-size:14px;margin-top:10px}

.warning-box{background:rgba(244,67,54,0.15);border:2px solid rgba(244,67,54,0.5);border-radius:15px;padding:20px;margin-top:20px;display:flex;gap:15px;align-items:start}
.warning-icon{font-size:2rem;color:#ff5252}
.warning-content{flex:1;color:white}
.warning-content strong{display:block;font-size:1.1rem;margin-bottom:5px}
.countdown-timer{display:inline-block;background:rgba(244,67,54,0.3);padding:4px 12px;border-radius:20px;font-weight:900;color:#ffeb3b;margin:0 3px}

/* =================== Payment Page =================== */
.payment-container{padding:20px}
.btn-back{background:rgba(255,255,255,0.2);color:white;border:2px solid rgba(255,255,255,0.3);padding:10px 20px;border-radius:10px;font-size:14px;cursor:pointer;transition:all 0.3s;margin-bottom:20px;display:inline-flex;align-items:center;gap:8px}
.btn-back:hover{background:rgba(255,255,255,0.3)}

.payment-header{text-align:center;margin-bottom:30px}
.payment-icon{font-size:60px;margin-bottom:15px}
.payment-header h2{color:white;font-size:2rem;margin-bottom:10px;font-weight:900}
.payment-subtitle{color:rgba(255,255,255,0.9);font-size:1rem}

.payment-methods{display:grid;gap:15px;margin-bottom:30px}
.payment-method{background:rgba(255,255,255,0.95);padding:20px;border-radius:15px;cursor:pointer;transition:all 0.3s;border:3px solid transparent}
.payment-method:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,0,0,0.15)}
.payment-method.selected{border-color:#ffd89b;background:white;box-shadow:0 8px 25px rgba(255,216,155,0.4)}

.method-header{display:flex;align-items:center;gap:15px;margin-bottom:15px}
.method-icon{font-size:2rem;min-width:50px;height:50px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-radius:12px;display:flex;align-items:center;justify-content:center}
.method-title{flex:1}
.method-title h3{font-size:1.2rem;color:#1a237e;margin-bottom:3px}
.method-subtitle{font-size:13px;color:#666}
.method-radio{width:24px;height:24px;accent-color:#667eea}

.method-content{display:none;margin-top:15px;padding-top:15px;border-top:2px solid #f0f0f0}
.payment-method.selected .method-content{display:block}

.payment-details{background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:20px}
.detail-row{display:flex;justify-content:space-between;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #e0e0e0}
.detail-row:last-child{border-bottom:none;font-weight:700;font-size:1.1rem;color:#1a237e}
.detail-label{color:#666}
.detail-value{font-weight:600;color:#1a237e}

.bank-info{background:#e3f2fd;padding:15px;border-radius:10px;margin-bottom:15px}
.bank-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-bottom:10px;border-bottom:1px dashed rgba(0,0,0,0.1)}
.bank-row:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none}
.bank-label{color:#666;font-size:14px}
.bank-value{font-weight:700;color:#1a237e;font-family:monospace;font-size:16px}
.btn-copy{background:#667eea;color:white;border:none;padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;transition:all 0.3s}
.btn-copy:hover{background:#5568d3}

.qr-code{text-align:center;padding:20px;background:white;border-radius:12px;margin-bottom:15px}
.qr-placeholder{width:200px;height:200px;margin:0 auto 15px;background:#f0f0f0;border:3px dashed #ccc;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:3rem;color:#ccc}

.payment-steps{background:rgba(255,255,255,0.95);padding:20px;border-radius:15px;margin-bottom:20px}
.payment-steps h3{color:#1a237e;margin-bottom:15px;font-size:1.2rem}
.step-item{display:flex;gap:12px;margin-bottom:15px;align-items:start}
.step-item:last-child{margin-bottom:0}
.step-number{min-width:30px;height:30px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px}
.step-text{flex:1;color:#333;line-height:30px;font-size:14px}
.step-text strong{color:#1a237e}

.whatsapp-link{display:inline-flex;align-items:center;gap:10px;background:#25d366;color:white;padding:12px 24px;border-radius:10px;text-decoration:none;font-weight:600;transition:all 0.3s;margin-top:10px}
.whatsapp-link:hover{background:#1da851;transform:translateY(-2px)}

.activation-section{background:rgba(255,255,255,0.95);padding:25px;border-radius:15px;text-align:center}
.activation-section h3{color:#1a237e;margin-bottom:10px;font-size:1.3rem}
.activation-hint{color:#666;font-size:14px;margin-bottom:20px}
.activation-input-group{display:flex;gap:10px}
.activation-input{flex:1;padding:12px;border:2px solid #e0e0e0;border-radius:10px;font-size:15px;text-align:center;font-family:monospace;text-transform:uppercase}
.btn-activate{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:white;border:none;padding:12px 30px;border-radius:10px;font-weight:700;cursor:pointer;transition:all 0.3s;white-space:nowrap}
.btn-activate:hover{transform:scale(1.05)}

/* =================== Responsive =================== */
@media (max-width: 768px){
.nav{padding:10px 5px}
.nav-item{padding:10px 5px;font-size:12px}
.nav-item i{font-size:20px;margin-bottom:3px}
.stats-grid{grid-template-columns:repeat(2,1fr)}
.card{padding:15px}
.card-title{font-size:1.2rem}
.student-item{flex-direction:column;align-items:start;gap:15px}
.student-actions{width:100%;justify-content:space-between}
.export-buttons{flex-direction:column}
.export-buttons .btn{width:100%}
.attendance-table{font-size:14px}
.attendance-table th,.attendance-table td{padding:10px 8px}
.lock-main-title{font-size:1.5rem}
.feature-item{flex-direction:column;text-align:center}
.warning-box{flex-direction:column;text-align:center}
.activation-input-group{flex-direction:column}
.btn-activate{width:100%}
}

/* =================== Print Styles =================== */
@media print{
.nav,.btn,.modal,.toast,#lockScreen,#paymentPage{display:none!important}
.page{display:block!important}
body{background:white}
.card{box-shadow:none;page-break-inside:avoid}
}

/* =================== Animations =================== */
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
.fade-in{animation:fadeIn 0.5s ease-in-out}
.slide-up{animation:slideUp 0.5s ease-out}

/* =================== Scrollbar =================== */
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}
::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:10px}
::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#5568d3 0%,#6a3f8f 100%)}

/* =================== Additional Utility Classes =================== */
.text-center{text-align:center}
.mt-10{margin-top:10px}
.mt-20{margin-top:20px}
.mb-10{margin-bottom:10px}
.mb-20{margin-bottom:20px}
.w-100{width:100%}
.d-flex{display:flex}
.gap-10{gap:10px}
.justify-between{justify-content:space-between}
.align-center{align-items:center}
</style>
</head>
<body>

<!-- Lock Screen -->
<div id="lockScreen" style="display:none;">
  <div class="lock-overlay"></div>
  <div class="lock-container">
    <div class="lock-header">
      <div class="lock-icon-main">ğŸ”’</div>
      <h1 class="lock-main-title">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ</h1>
      <p class="lock-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</p>
    </div>
    <div class="features-grid">
      <div class="feature-item"><div class="feature-icon">ğŸ“Š</div><div class="feature-content"><div class="feature-title">ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ©</div><div class="feature-text">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø© Ø¨ØµÙŠØº Ù…ØªØ¹Ø¯Ø¯Ø© (Excel, PDF)</div></div></div>
      <div class="feature-item"><div class="feature-icon">ğŸ“±</div><div class="feature-content"><div class="feature-title">ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙˆØ§ÙÙ‚</div><div class="feature-text">ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¨Ø³Ù„Ø§Ø³Ø© ØªØ§Ù…Ø©</div></div></div>
      <div class="feature-item"><div class="feature-icon">â˜ï¸</div><div class="feature-content"><div class="feature-title">Ø³Ø­Ø§Ø¨Ø© Ø¢Ù…Ù†Ø©</div><div class="feature-text">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø£Ù…Ø§Ù† ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</div></div></div>
      <div class="feature-item"><div class="feature-icon">ğŸ”„</div><div class="feature-content"><div class="feature-title">ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø³ØªÙ…Ø±Ø©</div><div class="feature-text">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div></div></div>
      <div class="feature-item"><div class="feature-icon">ğŸ’¬</div><div class="feature-content"><div class="feature-title">Ø¯Ø¹Ù… ÙÙ†ÙŠ</div><div class="feature-text">Ø¯Ø¹Ù… ÙÙ†ÙŠ Ù…Ø¬Ø§Ù†ÙŠ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©</div></div></div>
      </div>
      <button class="btn-subscribe-main" onclick="app.showPaymentPage()">ğŸš€ Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ§Ø³ØªØ±Ø¬Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</button>
      <p class="guarantee">ğŸ’¯ Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø®Ù„Ø§Ù„ 14 ÙŠÙˆÙ…</p>
    </div>
    <div class="warning-box">
      <span class="warning-icon">âš ï¸</span>
      <div class="warning-content"><strong>ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…:</strong> Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ <span class="countdown-timer" id="trialDaysLeft">0</span> Ø£ÙŠØ§Ù… Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©. Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ!</div>
    </div>
  </div>
</div>

<!-- Payment Page -->
<div id="paymentPage" style="display:none;">
  <div class="lock-overlay"></div>
  <div class="payment-container">
    <button class="btn-back" onclick="app.hidePaymentPage()">â† Ø±Ø¬ÙˆØ¹</button>
    <div class="payment-header">
      <div class="payment-icon">ğŸ’³</div>
      <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹</h2>
      <p class="payment-subtitle">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</p>
    </div>
    <div class="payment-methods">
      <div class="payment-method" id="bankTransfer" onclick="app.selectPaymentMethod('bank')">
        <div class="method-header">
          <div class="method-icon">ğŸ¦</div>
          <div class="method-title"><h3>Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ</h3><p class="method-subtitle">Ø§Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</p></div>
          <input type="radio" name="paymentMethod" value="bank" class="method-radio">
        </div>
        <div class="method-content">
          <div class="bank-info">
            <div class="bank-row"><span class="bank-label">Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†:</span><span class="bank-value">SA1234567891234567891234</span><button class="btn-copy" onclick="app.copyToClipboard('SA1234567891234567891234')">Ù†Ø³Ø®</button></div>
            <div class="bank-row"><span class="bank-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯:</span><span class="bank-value">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ</span></div>
            <div class="bank-row"><span class="bank-label">Ø§Ù„Ø¨Ù†Ùƒ:</span><span class="bank-value">Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ</span></div>
            <div class="bank-row"><span class="bank-label">Ø§Ù„Ù…Ø¨Ù„Øº:</span><span class="bank-value">35 Ø±ÙŠØ§Ù„</span></div>
          </div>
          <div class="qr-code">
            <div class="qr-placeholder">ğŸ“±</div>
            <p style="color:#666;font-size:14px;">Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø¬ÙˆØ§Ù„</p>
          </div>
        </div>
      </div>
      <div class="payment-method" id="whatsappPay" onclick="app.selectPaymentMethod('whatsapp')">
        <div class="method-header">
          <div class="method-icon">ğŸ’¬</div>
          <div class="method-title"><h3>Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</h3><p class="method-subtitle">ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„</p></div>
          <input type="radio" name="paymentMethod" value="whatsapp" class="method-radio">
        </div>
        <div class="method-content">
          <p style="color:#666;margin-bottom:15px;font-size:14px;">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙÙˆØ±Ø§Ù‹</p>
          <a href="https://wa.me/966533371147?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ" class="whatsapp-link" target="_blank" style="width:100%;justify-content:center;">
            <i class="fab fa-whatsapp"></i> ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
          </a>
        </div>
      </div>
    </div>
    <div class="payment-details">
      <div class="detail-row"><span class="detail-label">Ø³Ø¹Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ:</span><span class="detail-value">35 Ø±ÙŠØ§Ù„</span></div>
      <div class="detail-row"><span class="detail-label">Ø§Ù„Ø®ØµÙ…:</span><span class="detail-value">0 Ø±ÙŠØ§Ù„</span></div>
      <div class="detail-row"><span class="detail-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span class="detail-value">35 Ø±ÙŠØ§Ù„</span></div>
    </div>
    <div class="payment-steps">
      <h3>Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„:</h3>
      <div class="step-item"><div class="step-number">1</div><div class="step-text">Ø§Ø®ØªØ± <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</strong> Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ</div></div>
      <div class="step-item"><div class="step-number">2</div><div class="step-text">Ù‚Ù… Ø¨ØªØ­ÙˆÙŠÙ„ <strong>35 Ø±ÙŠØ§Ù„</strong> Ù„Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</div></div>
      <div class="step-item"><div class="step-number">3</div><div class="step-text">Ø£Ø±Ø³Ù„ <strong>Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</strong> Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</div></div>
      <div class="step-item"><div class="step-number">4</div><div class="step-text">Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ <strong>ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„</strong> Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚</div></div>
<a href="https://wa.me/966533371147?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ" class="whatsapp-link" target="_blank" style="width:100%;margin-top:15px;justify-content:center;"><i class="fab fa-whatsapp"></i> Ø£Ø±Ø³Ù„ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</a>
    </div>
    <div class="activation-section">
      <h3>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ØŸ</h3>
      <p class="activation-hint">Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ØŒ Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„</p>
      <div class="activation-input-group">
        <input type="text" id="activationCodeInput" placeholder="SK-XXXXX-XXXXX" class="activation-input">
        <button onclick="app.activateSubscription()" class="btn-activate">ØªÙØ¹ÙŠÙ„</button>
      </div>
    </div>
  </div>
</div>

<div class="container">
<!-- Navigation -->
<nav class="nav">
<div class="nav-item active" onclick="app.showPage('main')"><i class="fas fa-home"></i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
<div class="nav-item" onclick="app.showPage('students')"><i class="fas fa-users"></i><span>Ø§Ù„Ø·Ù„Ø§Ø¨</span></div>
<div class="nav-item" onclick="app.showPage('attendance')"><i class="fas fa-clipboard-list"></i><span>Ø§Ù„Ø­Ø¶ÙˆØ±</span></div>
<div class="nav-item" onclick="app.showPage('reports')"><i class="fas fa-chart-bar"></i><span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span></div>
<div class="nav-item" onclick="app.showPage('settings')"><i class="fas fa-cog"></i><span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></div>
</nav>

<!-- Main Page -->
<div id="mainPage" class="page active">
<!-- Subscription Badge -->
<div class="subscription-badge trial" id="subscriptionBadge">
<div class="subscription-icon">â°</div>
<div class="subscription-info">
<div class="subscription-status" id="subscriptionStatus">ÙØªØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</div>
<div class="subscription-expiry" id="subscriptionExpiry">Ù…ØªØ¨Ù‚ÙŠ 7 Ø£ÙŠØ§Ù…</div>
<div class="subscription-expiry" id="activationCodeDisplay" style="font-family: monospace; font-weight: bold; color: #667eea; margin-top: 5px;"></div>
</div>
<button class="btn btn-warning" onclick="app.showPaymentPage()" style="white-space:nowrap;">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</button>
</div>

<!-- Stats Cards -->
<div class="stats-grid">
<div class="stat-card"><div class="stat-icon">ğŸ‘¥</div><div class="stat-value" id="totalStudents">0</div><div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</div></div>
<div class="stat-card"><div class="stat-icon">âœ…</div><div class="stat-value" id="presentToday">0</div><div class="stat-label">Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…</div></div>
<div class="stat-card"><div class="stat-icon">âŒ</div><div class="stat-value" id="absentToday">0</div><div class="stat-label">Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„ÙŠÙˆÙ…</div></div>
<div class="stat-card"><div class="stat-icon">ğŸ“Š</div><div class="stat-value" id="attendanceRate">0%</div><div class="stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div></div>
</div>

<!-- Quick Actions -->
<div class="card">
<div class="card-header"><h2 class="card-title"><i class="fas fa-bolt"></i>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2></div>
<div class="d-flex gap-10" style="flex-wrap:wrap;">
<button class="btn btn-primary" onclick="app.showPage('students')"><i class="fas fa-user-plus"></i>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
<button class="btn btn-success" onclick="app.markAllPresent()"><i class="fas fa-check-double"></i>ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
<button class="btn btn-warning" onclick="app.showPage('reports')"><i class="fas fa-file-export"></i>ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
</div>
</div>

<!-- Recent Activity -->
<div class="card">
<div class="card-header"><h2 class="card-title"><i class="fas fa-history"></i>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±</h2></div>
<div id="recentActivity"></div>
</div>
</div>

<!-- Students Page -->
<div id="studentsPage" class="page">
<div class="card">
<div class="card-header">
<h2 class="card-title"><i class="fas fa-users"></i>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
<button class="btn btn-primary" onclick="app.showAddStudentModal()"><i class="fas fa-user-plus"></i>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
</div>

<!-- Search Box -->
<div class="search-box">
<input type="text" class="search-input" id="studentSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ..." oninput="app.searchStudents()">
<i class="fas fa-search search-icon"></i>
</div>

<!-- Import/Export Buttons -->
<div class="export-buttons">
<label for="excelFile" class="btn btn-success" style="margin:0;cursor:pointer;"><i class="fas fa-file-excel"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel</label>
<input type="file" id="excelFile" accept=".xlsx,.xls" style="display:none;">
<button class="btn btn-primary" onclick="app.exportStudentsExcel()"><i class="fas fa-download"></i>ØªØµØ¯ÙŠØ± Excel</button>
<button class="btn btn-danger" onclick="app.deleteAllStudents()"><i class="fas fa-trash"></i>Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
</div>

<!-- File Upload Hint -->
<div class="file-upload" style="margin-top:20px;padding:20px;">
<div class="file-icon">ğŸ“„</div>
<div class="file-text">Ù‚Ù… Ø¨Ø±ÙØ¹ Ù…Ù„Ù Excel ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰: Ø§Ù„Ø§Ø³Ù… - Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ - Ø§Ù„Ø¬ÙˆØ§Ù„ - Ø§Ù„ØµÙ - Ø§Ù„ÙØµÙ„</div>
<div class="file-subtext">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 5MB | Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: XLSX, XLS</div>
</div>

<!-- Students List -->
<div class="student-list" id="studentsList"></div>
</div>
</div>

<!-- Attendance Page -->
<div id="attendancePage" class="page">
<div class="card">
<div class="card-header">
<h2 class="card-title"><i class="fas fa-clipboard-check"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h2>
<div class="d-flex gap-10">
<input type="date" class="form-input" id="attendanceDate" style="width:auto;" onchange="app.loadAttendance()">
<button class="btn btn-success" onclick="app.markAllPresent()"><i class="fas fa-check-double"></i>Ø­Ø¶ÙˆØ± Ø§Ù„ÙƒÙ„</button>
</div>
</div>

<!-- Search Box -->
<div class="search-box">
<input type="text" class="search-input" id="attendanceSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨..." oninput="app.searchAttendance()">
<i class="fas fa-search search-icon"></i>
</div>

<!-- Attendance Stats -->
<div class="stats-grid">
<div class="stat-card"><div class="stat-icon">âœ…</div><div class="stat-value" id="presentCount">0</div><div class="stat-label">Ø­Ø§Ø¶Ø±</div></div>
<div class="stat-card"><div class="stat-icon">âŒ</div><div class="stat-value" id="absentCount">0</div><div class="stat-label">ØºØ§Ø¦Ø¨</div></div>
<div class="stat-card"><div class="stat-icon">â°</div><div class="stat-value" id="lateCount">0</div><div class="stat-label">Ù…ØªØ£Ø®Ø±</div></div>
</div>

<!-- Attendance List -->
<div id="attendanceList"></div>
</div>
</div>

<!-- Reports Page -->
<div id="reportsPage" class="page">
<div class="card">
<div class="card-header"><h2 class="card-title"><i class="fas fa-chart-line"></i>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2></div>

<!-- Date Range -->
<div class="d-flex gap-10 mb-20" style="flex-wrap:wrap;">
<div class="form-group" style="flex:1;margin:0;"><label class="form-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label><input type="date" class="form-input" id="reportStartDate"></div>
<div class="form-group" style="flex:1;margin:0;"><label class="form-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label><input type="date" class="form-input" id="reportEndDate"></div>
<button class="btn btn-primary" onclick="app.generateReport()" style="align-self:flex-end;"><i class="fas fa-sync"></i>ØªØ­Ø¯ÙŠØ«</button>
</div>

<!-- Export Buttons -->
<div class="export-buttons">
<button class="btn btn-success" onclick="app.exportReportExcel()"><i class="fas fa-file-excel"></i>ØªØµØ¯ÙŠØ± Excel</button>
<button class="btn btn-danger" onclick="app.exportReportPDF()"><i class="fas fa-file-pdf"></i>ØªØµØ¯ÙŠØ± PDF</button>
<button class="btn btn-primary" onclick="app.printReport()"><i class="fas fa-print"></i>Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<!-- Report Content -->
<div id="reportContent"></div>
</div>
</div>

<!-- Settings Page -->
<div id="settingsPage" class="page">
<div class="card">
<div class="card-header"><h2 class="card-title"><i class="fas fa-cog"></i>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2></div>

<!-- School Info -->
<div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label><input type="text" class="form-input" id="schoolName" placeholder="Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©" value="Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©"></div>
<div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</label><input type="text" class="form-input" id="teacherName" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯" value="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"></div>

<!-- Subscription Info -->
<div style="background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:20px;">
<h3 style="color:#1a237e;margin-bottom:15px;display:flex;align-items:center;gap:10px;"><i class="fas fa-crown" style="color:#ffd700;"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
<div style="display:grid;gap:10px;">
<div style="display:flex;justify-content:space-between;padding:10px;background:white;border-radius:8px;"><span style="color:#666;">Ø§Ù„Ø­Ø§Ù„Ø©:</span><span id="settingsStatus" style="font-weight:700;color:#ff9800;">ÙØªØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</span></div>
<div style="display:flex;justify-content:space-between;padding:10px;background:white;border-radius:8px;"><span style="color:#666;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</span><span id="settingsExpiry" style="font-weight:700;color:#1a237e;">--</span></div>
<div style="display:flex;justify-content:space-between;padding:10px;background:white;border-radius:8px;"><span style="color:#666;">Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</span><span id="settingsDaysLeft" style="font-weight:700;color:#f44336;">7 Ø£ÙŠØ§Ù…</span></div>
</div>
</div>

<!-- Activation Section -->
<div style="background:#e3f2fd;padding:20px;border-radius:12px;margin-bottom:20px;">
<h3 style="color:#1a237e;margin-bottom:10px;"><i class="fas fa-key"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
<p style="color:#666;font-size:14px;margin-bottom:15px;">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù…Ø¯Ø© Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</p>
<input type="text" id="activationCodeSettings" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø°ÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡" style="width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;margin-bottom:15px;">
<button onclick="app.activateSubscription('settings')" class="btn btn-success w-100"><i class="fas fa-check-circle"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
<button onclick="app.showPaymentPage()" class="btn btn-primary w-100 mt-10"><i class="fas fa-shopping-cart"></i> Ø´Ø±Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„</button>
</div>

<!-- Actions -->
<div class="d-flex gap-10" style="flex-wrap:wrap;">
<button class="btn btn-primary" onclick="app.saveSettings()"><i class="fas fa-save"></i>Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
<button class="btn btn-danger" onclick="app.resetApp()"><i class="fas fa-redo"></i>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
</div>

<!-- Developer Info -->
<div style="margin-top:30px;padding:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:12px;color:white;text-align:center;">
<div style="font-size:2.5rem;margin-bottom:10px;">ğŸ‘¨â€ğŸ’»</div>
<h3 style="margin-bottom:5px;">Ù…ØªØ®ØµØµ ÙÙŠ ØªØ·ÙˆÙŠØ± Ø£Ù†Ø¸Ù…Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h3>
<p style="font-size:14px;opacity:0.9;margin-bottom:15px;">Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© â€¢ Ø¯Ø¹Ù… Ù…Ø³ØªÙ…Ø± â€¢ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙˆØ±ÙŠØ©</p>
<a href="https://wa.me/966533371147" class="whatsapp-link" target="_blank" style="display:inline-flex;"><i class="fab fa-whatsapp"></i>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
</div>

<!-- App Info -->
<div style="margin-top:20px;padding:15px;background:#f8f9fa;border-radius:8px;text-align:center;color:#666;font-size:13px;">
<strong style="color:#1a237e;">Ø§Ù„Ø§Ø³Ù…:</strong> Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ | 
<strong style="color:#1a237e;">Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> 5.0.0 | 
<strong style="color:#1a237e;">Ø§Ù„ØªØ­Ø¯ÙŠØ«:</strong> Ø£ÙƒØªÙˆØ¨Ø± 2025 | 
<strong style="color:#1a237e;">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</strong> 35 Ø±ÙŠØ§Ù„ Ø³Ù†ÙˆÙŠØ§Ù‹
</div>
</div>
</div>

</div>

<!-- Add/Edit Student Modal -->
<div id="studentModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title" id="modalTitle">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
<button class="modal-close" onclick="app.closeStudentModal()">Ã—</button>
</div>
<form onsubmit="app.saveStudent(event)">
<div class="form-group"><label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input type="text" class="form-input" id="studentName" required></div>
<div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ</label><input type="text" class="form-input" id="studentID" required></div>
<div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="tel" class="form-input" id="studentPhone"></div>
<div class="form-group"><label class="form-label">Ø§Ù„ØµÙ</label><select class="form-select" id="studentGrade" required><option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option><option>Ø§Ù„Ø£ÙˆÙ„</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠ</option><option>Ø§Ù„Ø«Ø§Ù„Ø«</option><option>Ø§Ù„Ø±Ø§Ø¨Ø¹</option><option>Ø§Ù„Ø®Ø§Ù…Ø³</option><option>Ø§Ù„Ø³Ø§Ø¯Ø³</option></select></div>
<div class="form-group"><label class="form-label">Ø§Ù„ÙØµÙ„</label><input type="text" class="form-input" id="studentClass" placeholder="Ø£ØŒ Ø¨ØŒ Ø¬..." required></div>
<div class="d-flex gap-10"><button type="submit" class="btn btn-primary" style="flex:1;"><i class="fas fa-save"></i>Ø­ÙØ¸</button><button type="button" class="btn btn-secondary" style="flex:1;" onclick="app.closeStudentModal()">Ø¥Ù„ØºØ§Ø¡</button></div>
</form>
</div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<script>
// Firebase Configuration
const firebaseConfig = {
apiKey: "AIzaSyAWcfGHGtV0123456789abcdefghijklmn",
authDomain: "attendance-app.firebaseapp.com",
databaseURL: "https://attendance-app-default-rtdb.firebaseio.com",
projectId: "attendance-app",
storageBucket: "attendance-app.appspot.com",
messagingSenderId: "123456789012",
appId: "1:123456789012:web:abc123def456"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// App Class
class AttendanceApp {
constructor() {
this.students = [];
this.attendance = {};
this.currentStudentId = null;
this.subscription = {
status: 'trial',
startDate: new Date().toISOString(),
expiryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
activationCode: '',
isActive: false
};
this.init();
}

init() {
this.loadFromLocalStorage();
this.setupEventListeners();
this.updateUI();
this.checkSubscription();
this.setTodayDate();
}

setupEventListeners() {
const excelFile = document.getElementById('excelFile');
if (excelFile) {
const self = this;
excelFile.addEventListener('change', function (e) { self.importExcel(e); });
}
}

showPage(page) {
document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
document.getElementById(page + 'Page').classList.add('active');
event.target.closest('.nav-item').classList.add('active');

if (page === 'attendance') this.loadAttendance();
if (page === 'reports') this.generateReport();
if (page === 'settings') this.loadSettings();
}

// =================== Student Management ===================

showAddStudentModal() {
document.getElementById('modalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯';
document.getElementById('studentModal').classList.add('active');
this.currentStudentId = null;
document.querySelector('#studentModal form').reset();
}

showEditStudentModal(id) {
const student = this.students.find(s => s.id === id);
if (!student) return;

document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨';
document.getElementById('studentName').value = student.name;
document.getElementById('studentID').value = student.civilId;
document.getElementById('studentPhone').value = student.phone || '';
document.getElementById('studentGrade').value = student.grade;
document.getElementById('studentClass').value = student.class;
document.getElementById('studentModal').classList.add('active');
this.currentStudentId = id;
}

closeStudentModal() {
document.getElementById('studentModal').classList.remove('active');
this.currentStudentId = null;
}

saveStudent(event) {
event.preventDefault();

const student = {
id: this.currentStudentId || Date.now().toString(),
name: document.getElementById('studentName').value.trim(),
civilId: document.getElementById('studentID').value.trim(),
phone: document.getElementById('studentPhone').value.trim(),
grade: document.getElementById('studentGrade').value,
class: document.getElementById('studentClass').value.trim(),
addedDate: this.currentStudentId ? 
(this.students.find(s => s.id === this.currentStudentId)?.addedDate || new Date().toISOString()) : 
new Date().toISOString()
};

if (this.currentStudentId) {
const index = this.students.findIndex(s => s.id === this.currentStudentId);
this.students[index] = student;
this.showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
} else {
this.students.push(student);
this.showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

this.saveToLocalStorage();
this.updateStudentsList();
this.closeStudentModal();
this.updateStats();
}

deleteStudent(id) {
if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡!')) return;

this.students = this.students.filter(s => s.id !== id);
// Delete attendance records
Object.keys(this.attendance).forEach(date => {
if (this.attendance[date][id]) {
delete this.attendance[date][id];
}
});

this.saveToLocalStorage();
this.updateStudentsList();
this.showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
this.updateStats();
}

deleteAllStudents() {
const message = 'ØªØ­Ø°ÙŠØ± Ø®Ø·ÙŠØ±!\n\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ:\nâœ— Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨\nâœ— Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±\nâœ— Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ØŸ';
if (!confirm(message)) return;

const confirmMessage = 'ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ!\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.\nØ§ÙƒØªØ¨ "Ù†Ø¹Ù…" Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
const userInput = prompt(confirmMessage);
if (userInput !== 'Ù†Ø¹Ù…') return;

this.students = [];
this.attendance = {};
this.saveToLocalStorage();
this.updateStudentsList();
this.updateStats();
this.showToast('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info');
}

searchStudents() {
const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
const filtered = this.students.filter(s => 
s.name.toLowerCase().includes(searchTerm) || 
s.civilId.includes(searchTerm)
);
this.updateStudentsList(filtered);
}

updateStudentsList(students = this.students) {
const list = document.getElementById('studentsList');
if (students.length === 0) {
list.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div class="empty-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</div><div class="empty-subtext">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ø§Ù„Ø¨</div></div>';
return;
}

list.innerHTML = students.map(s => `
<div class="student-item">
<div class="student-info">
<div class="student-name">${s.name}</div>
<div class="student-details">
<span class="student-detail"><i class="fas fa-id-card"></i>${s.civilId}</span>
<span class="student-detail"><i class="fas fa-phone"></i>${s.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
<span class="student-detail"><i class="fas fa-graduation-cap"></i>${s.grade} - ${s.class}</span>
</div>
</div>
<div class="student-actions">
<button class="btn-icon edit" onclick="app.showEditStudentModal('${s.id}')" title="ØªØ¹Ø¯ÙŠÙ„"><i class="fas fa-edit"></i></button>
<button class="btn-icon delete" onclick="app.deleteStudent('${s.id}')" title="Ø­Ø°Ù"><i class="fas fa-trash"></i></button>
</div>
</div>
`).join('');
}

// =================== Excel Import/Export ===================

importExcel(e) {
const file = e.target.files[0];
if (!file) return;

const reader = new FileReader();
const self = this;

reader.onload = function (ev) {
try {
const data = new Uint8Array(ev.target.result);
const workbook = XLSX.read(data, { type: 'array' });
const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

// Skip header row and process data
let imported = 0;
for (let i = 1; i < jsonData.length; i++) {
const row = jsonData[i];
if (!row[0]) continue; // Skip empty rows

// Map columns: Name(0), CivilID(1), Phone(2), Grade(3), Class(4)
const student = {
id: Date.now().toString() + i,
name: String(row[0] || '').trim(),
civilId: String(row[1] || '').trim(),
phone: String(row[2] || '').trim(),
grade: String(row[3] || '').trim(),
class: String(row[4] || '').trim(),
addedDate: new Date().toISOString()
};

// Validate required fields
if (student.name && student.civilId && student.grade && student.class) {
self.students.push(student);
imported++;
}
}

self.saveToLocalStorage();
self.updateStudentsList();
self.updateStats();
self.showToast(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${imported} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`, 'success');

// Reset file input
e.target.value = '';
} catch (error) {
console.error('Import error:', error);
self.showToast('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚', 'error');
}
};

reader.readAsArrayBuffer(file);
}

exportStudentsExcel() {
if (this.students.length === 0) {
this.showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
return;
}

const data = [
['#', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ', 'Ø§Ù„Ø¬ÙˆØ§Ù„', 'Ø§Ù„ØµÙ', 'Ø§Ù„ÙØµÙ„', 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©'],
...this.students.map((s, i) => [
i + 1,
s.name,
s.civilId,
s.phone || '',
s.grade,
s.class,
new Date(s.addedDate).toLocaleDateString('ar-SA')
])
];

const ws = XLSX.utils.aoa_to_sheet(data);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ø·Ù„Ø§Ø¨');
XLSX.writeFile(wb, `Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ø·Ù„Ø§Ø¨_${new Date().toLocaleDateString('ar-SA')}.xlsx`);
this.showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// =================== Attendance Management ===================

setTodayDate() {
const today = new Date().toISOString().split('T')[0];
const dateInput = document.getElementById('attendanceDate');
if (dateInput) dateInput.value = today;
}

loadAttendance() {
const date = document.getElementById('attendanceDate').value;
if (!date) return;

const list = document.getElementById('attendanceList');
if (this.students.length === 0) {
list.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div class="empty-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</div></div>';
return;
}

list.innerHTML = '<div class="student-list">' + this.students.map(s => {
const status = this.attendance[date]?.[s.id] || 'absent';
return `
<div class="student-item">
<div class="student-info">
<div class="student-name">${s.name}</div>
<div class="student-details">
<span class="student-detail"><i class="fas fa-graduation-cap"></i>${s.grade} - ${s.class}</span>
</div>
</div>
<div class="student-actions">
<button class="btn-icon present ${status === 'present' ? 'active' : ''}" 
onclick="app.markAttendance('${s.id}', 'present')" title="Ø­Ø§Ø¶Ø±">
<i class="fas fa-check"></i>
</button>
<button class="btn-icon absent ${status === 'absent' ? 'active' : ''}" 
onclick="app.markAttendance('${s.id}', 'absent')" title="ØºØ§Ø¦Ø¨">
<i class="fas fa-times"></i>
</button>
</div>
</div>
`;
}).join('') + '</div>';

this.updateAttendanceStats();
}

markAttendance(studentId, status) {
const date = document.getElementById('attendanceDate').value;
if (!date) return;

if (!this.attendance[date]) this.attendance[date] = {};
this.attendance[date][studentId] = status;

this.saveToLocalStorage();
this.loadAttendance();
this.updateStats();
}

markAllPresent() {
const date = document.getElementById('attendanceDate')?.value || new Date().toISOString().split('T')[0];
if (!this.attendance[date]) this.attendance[date] = {};

this.students.forEach(s => {
this.attendance[date][s.id] = 'present';
});

this.saveToLocalStorage();
this.loadAttendance();
this.updateStats();
this.showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨', 'success');
}

searchAttendance() {
const searchTerm = document.getElementById('attendanceSearch').value.toLowerCase();
const filtered = this.students.filter(s => s.name.toLowerCase().includes(searchTerm));
// For simplicity, reload with filtered list
this.loadAttendance();
}

updateAttendanceStats() {
const date = document.getElementById('attendanceDate').value;
const dayAttendance = this.attendance[date] || {};

let present = 0, absent = 0, late = 0;
this.students.forEach(s => {
const status = dayAttendance[s.id] || 'absent';
if (status === 'present') present++;
else if (status === 'absent') absent++;
else if (status === 'late') late++;
});

document.getElementById('presentCount').textContent = present;
document.getElementById('absentCount').textContent = absent;
document.getElementById('lateCount').textContent = late;
}

// =================== Statistics & Reports ===================

updateStats() {
const total = this.students.length;
document.getElementById('totalStudents').textContent = total;

const today = new Date().toISOString().split('T')[0];
const todayAttendance = this.attendance[today] || {};

let present = 0;
this.students.forEach(s => {
if (todayAttendance[s.id] === 'present') present++;
});

const absent = total - present;
const rate = total > 0 ? Math.round((present / total) * 100) : 0;

document.getElementById('presentToday').textContent = present;
document.getElementById('absentToday').textContent = absent;
document.getElementById('attendanceRate').textContent = rate + '%';
}

generateReport() {
const startDate = document.getElementById('reportStartDate').value;
const endDate = document.getElementById('reportEndDate').value;

if (!startDate || !endDate) {
document.getElementById('reportContent').innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“Š</div><div class="empty-text">Ø§Ø®ØªØ± Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®</div></div>';
return;
}

const dates = this.getDateRange(startDate, endDate);
const reportData = this.students.map(s => {
let presentDays = 0;
let absentDays = 0;

dates.forEach(date => {
const status = this.attendance[date]?.[s.id];
if (status === 'present') presentDays++;
else absentDays++;
});

const rate = dates.length > 0 ? Math.round((presentDays / dates.length) * 100) : 0;

return { ...s, presentDays, absentDays, rate };
});

const content = document.getElementById('reportContent');
content.innerHTML = `
<div style="overflow-x:auto;">
<table class="attendance-table">
<thead>
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„ØµÙ</th>
<th>Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</th>
<th>Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨</th>
<th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</th>
</tr>
</thead>
<tbody>
${reportData.map(s => `
<tr>
<td>${s.name}</td>
<td>${s.grade} - ${s.class}</td>
<td><span class="status-badge status-present">${s.presentDays}</span></td>
<td><span class="status-badge status-absent">${s.absentDays}</span></td>
<td><strong>${s.rate}%</strong></td>
</tr>
`).join('')}
</tbody>
</table>
</div>
`;

this.currentReportData = reportData;
this.currentReportDates = { startDate, endDate };
}

getDateRange(start, end) {
const dates = [];
const startDate = new Date(start);
const endDate = new Date(end);

while (startDate <= endDate) {
dates.push(startDate.toISOString().split('T')[0]);
startDate.setDate(startDate.getDate() + 1);
}

return dates;
}

exportReportExcel() {
if (!this.currentReportData) {
this.showToast('Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹', 'error');
return;
}

const data = [
['#', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ', 'Ø§Ù„ØµÙ', 'Ø§Ù„ÙØµÙ„', 'Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±', 'Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨', 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±'],
...this.currentReportData.map((s, i) => [
i + 1,
s.name,
s.civilId,
s.grade,
s.class,
s.presentDays,
s.absentDays,
s.rate + '%'
])
];

const ws = XLSX.utils.aoa_to_sheet(data);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±');
XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¶ÙˆØ±_${this.currentReportDates.startDate}_${this.currentReportDates.endDate}.xlsx`);
this.showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

exportReportPDF() {
this.showToast('Ù…ÙŠØ²Ø© ØªØµØ¯ÙŠØ± PDF Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
}

printReport() {
window.print();
}

// =================== Subscription Management ===================

checkSubscription() {
const now = new Date();
const expiry = new Date(this.subscription.expiryDate);
const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));

// Update displays
document.getElementById('trialDaysLeft').textContent = Math.max(0, daysLeft);

if (this.subscription.isActive) {
document.getElementById('subscriptionStatus').textContent = 'Ù…ÙØ¹Ù‘Ù„ âœ“';
document.getElementById('subscriptionExpiry').textContent = `ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ ${expiry.toLocaleDateString('ar-SA')}`;
document.getElementById('subscriptionBadge').className = 'subscription-badge active';
document.getElementById('lockScreen').style.display = 'none';
this.displayActivationCode();
} else if (daysLeft > 0) {
document.getElementById('subscriptionStatus').textContent = 'ÙØªØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©';
document.getElementById('subscriptionExpiry').textContent = `Ù…ØªØ¨Ù‚ÙŠ ${daysLeft} Ø£ÙŠØ§Ù…`;
document.getElementById('subscriptionBadge').className = 'subscription-badge trial';
document.getElementById('lockScreen').style.display = 'none';
} else {
document.getElementById('subscriptionStatus').textContent = 'Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©';
document.getElementById('subscriptionExpiry').textContent = 'ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯';
document.getElementById('subscriptionBadge').className = 'subscription-badge warning';
document.getElementById('lockScreen').style.display = 'flex';
}
}

displayActivationCode() {
if (this.subscription.activationCode && this.subscription.isActive) {
const displayElement = document.getElementById('activationCodeDisplay');
if (displayElement) {
displayElement.textContent = `ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„: ${this.subscription.activationCode}`;
displayElement.style.display = 'block';
}
}
}

activateSubscription(source = 'payment') {
const inputId = source === 'settings' ? 'activationCodeSettings' : 'activationCodeInput';
const code = document.getElementById(inputId).value.trim().toUpperCase();

if (!code) {
this.showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„', 'error');
return;
}

// Validate format: SK-XXXXX-XXXXX
if (!/^SK-[A-Z0-9]{5}-[A-Z0-9]{5}$/.test(code)) {
this.showToast('ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­. Ø§Ù„ØµÙŠØºØ© Ø§Ù„ØµØ­ÙŠØ­Ø©: SK-XXXXX-XXXXX', 'error');
return;
}

// Activate subscription
this.subscription.status = 'active';
this.subscription.isActive = true;
this.subscription.activationCode = code;
this.subscription.expiryDate = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString();

this.saveToLocalStorage();
this.checkSubscription();
this.hidePaymentPage();

this.showToast('ğŸ‰ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ', 'success');

setTimeout(() => location.reload(), 2000);
}

showPaymentPage() {
document.getElementById('lockScreen').style.display = 'none';
document.getElementById('paymentPage').style.display = 'block';
}

hidePaymentPage() {
document.getElementById('paymentPage').style.display = 'none';
document.getElementById('lockScreen').style.display = 'flex';
}

selectPaymentMethod(method) {
document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
document.querySelectorAll('.method-radio').forEach(r => r.checked = false);

if (method === 'bank') {
document.getElementById('bankTransfer').classList.add('selected');
document.querySelector('#bankTransfer .method-radio').checked = true;
} else if (method === 'whatsapp') {
document.getElementById('whatsappPay').classList.add('selected');
document.querySelector('#whatsappPay .method-radio').checked = true;
}
}

copyToClipboard(text) {
navigator.clipboard.writeText(text).then(() => {
this.showToast('ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­', 'success');
});
}

// =================== Settings ===================

loadSettings() {
document.getElementById('schoolName').value = localStorage.getItem('schoolName') || 'Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©';
document.getElementById('teacherName').value = localStorage.getItem('teacherName') || 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯';

const expiry = new Date(this.subscription.expiryDate);
const daysLeft = Math.ceil((expiry - new Date()) / (1000 * 60 * 60 * 24));

document.getElementById('settingsStatus').textContent = this.subscription.isActive ? 'Ù…ÙØ¹Ù‘Ù„ âœ“' : 'ÙØªØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©';
document.getElementById('settingsExpiry').textContent = expiry.toLocaleDateString('ar-SA');
document.getElementById('settingsDaysLeft').textContent = `${Math.max(0, daysLeft)} Ø£ÙŠØ§Ù…`;
}

saveSettings() {
localStorage.setItem('schoolName', document.getElementById('schoolName').value);
localStorage.setItem('teacherName', document.getElementById('teacherName').value);
this.showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

resetApp() {
if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!')) return;

localStorage.clear();
location.reload();
}

// =================== Utilities ===================

saveToLocalStorage() {
localStorage.setItem('students', JSON.stringify(this.students));
localStorage.setItem('attendance', JSON.stringify(this.attendance));
localStorage.setItem('subscription', JSON.stringify(this.subscription));
}

loadFromLocalStorage() {
const students = localStorage.getItem('students');
const attendance = localStorage.getItem('attendance');
const subscription = localStorage.getItem('subscription');

if (students) this.students = JSON.parse(students);
if (attendance) this.attendance = JSON.parse(attendance);
if (subscription) this.subscription = { ...this.subscription, ...JSON.parse(subscription) };

this.updateStudentsList();
this.updateStats();
}

showToast(message, type = 'info') {
const toast = document.getElementById('toast');
const icons = { success: 'âœ“', error: 'âœ—', info: 'â„¹' };

toast.innerHTML = `<div class="toast-icon">${icons[type]}</div><div>${message}</div>`;
toast.className = `toast ${type} show`;

setTimeout(() => toast.classList.remove('show'), 3000);
}

updateUI() {
this.updateStudentsList();
this.updateStats();
}
}

// Initialize App
const app = new AttendanceApp();
</script>
</body>
</html>
